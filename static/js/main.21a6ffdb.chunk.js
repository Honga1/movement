(this.webpackJsonpmovement=this.webpackJsonpmovement||[]).push([[0],{30:function(t,i,n){},32:function(t,i,n){},36:function(t,i,n){"use strict";n.r(i);var o=n(6),e=n(1),r=n.n(e),a=n(22),s=n.n(a),p=(n(30),n(9)),c=[],O=n(3);var u=n(20),d=n.n(u),U=d.a.mark(P);function P(t){var i;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=t;case 1:return i++,n.next=5,T[i%T.length];case 5:n.next=1;break;case 7:case"end":return n.stop()}}),U)}var T=[{type:"TOUCH_DOWN",id:"REPLAY",position:[-351,111]},{type:"TOUCH_UP",id:"REPLAY",position:[-389,65]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-391,55]},{type:"TOUCH_UP",id:"REPLAY",position:[-389,54]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-377,54]},{type:"TOUCH_UP",id:"REPLAY",position:[-373,53]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-259,55]},{type:"TOUCH_UP",id:"REPLAY",position:[-124,39]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-61,32]},{type:"TOUCH_UP",id:"REPLAY",position:[-11,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-11,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-11,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-11,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-11,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-11,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-11,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-11,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-11,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-11,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-11,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-11,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-11,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-12,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-12,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-13,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-15,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-15,22]},{type:"TOUCH_UP",id:"REPLAY",position:[-15,22]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-15,22]},{type:"TOUCH_UP",id:"REPLAY",position:[-15,22]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-15,22]},{type:"TOUCH_UP",id:"REPLAY",position:[-17,22]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-17,22]},{type:"TOUCH_UP",id:"REPLAY",position:[-17,22]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-17,22]},{type:"TOUCH_UP",id:"REPLAY",position:[-17,22]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-17,22]},{type:"TOUCH_UP",id:"REPLAY",position:[-17,22]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-18,22]},{type:"TOUCH_UP",id:"REPLAY",position:[-21,21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-23,21]},{type:"TOUCH_UP",id:"REPLAY",position:[-38,16]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-39,15]},{type:"TOUCH_UP",id:"REPLAY",position:[-40,13]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-40,13]},{type:"TOUCH_UP",id:"REPLAY",position:[-41,-4]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-39,-11]},{type:"TOUCH_UP",id:"REPLAY",position:[-27,-37]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-18,-39]},{type:"TOUCH_UP",id:"REPLAY",position:[-8,-49]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-8,-49]},{type:"TOUCH_UP",id:"REPLAY",position:[5,-54]},{type:"TOUCH_DOWN",id:"REPLAY",position:[5,-55]},{type:"TOUCH_UP",id:"REPLAY",position:[6,-55]},{type:"TOUCH_DOWN",id:"REPLAY",position:[10,-55]},{type:"TOUCH_UP",id:"REPLAY",position:[-32,-82]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-42,-82]},{type:"TOUCH_UP",id:"REPLAY",position:[-109,-95]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-126,-97]},{type:"TOUCH_UP",id:"REPLAY",position:[-131,-201]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-90,-283]},{type:"TOUCH_UP",id:"REPLAY",position:[27,-338]},{type:"TOUCH_DOWN",id:"REPLAY",position:[134,-279]},{type:"TOUCH_UP",id:"REPLAY",position:[134,-261]},{type:"TOUCH_DOWN",id:"REPLAY",position:[123,-74]},{type:"TOUCH_UP",id:"REPLAY",position:[66,108]},{type:"TOUCH_DOWN",id:"REPLAY",position:[57,119]},{type:"TOUCH_UP",id:"REPLAY",position:[-154,47]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-360,-214]},{type:"TOUCH_UP",id:"REPLAY",position:[-22,-234]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-22,-234]},{type:"TOUCH_UP",id:"REPLAY",position:[-4,266]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-2,273]},{type:"TOUCH_UP",id:"REPLAY",position:[318,-108]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-57,-139]},{type:"TOUCH_UP",id:"REPLAY",position:[-471,-93]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-557,-329]},{type:"TOUCH_UP",id:"REPLAY",position:[94,-324]},{type:"TOUCH_DOWN",id:"REPLAY",position:[438,253]},{type:"TOUCH_UP",id:"REPLAY",position:[-374,-45]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-374,-45]},{type:"TOUCH_UP",id:"REPLAY",position:[34,-21]},{type:"TOUCH_DOWN",id:"REPLAY",position:[33,-21]},{type:"TOUCH_UP",id:"REPLAY",position:[-18,-266]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-68,-251]},{type:"TOUCH_UP",id:"REPLAY",position:[-259,64]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-194,-318]},{type:"TOUCH_UP",id:"REPLAY",position:[319,-280]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-111,252]},{type:"TOUCH_UP",id:"REPLAY",position:[-41,196]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-17,172]},{type:"TOUCH_UP",id:"REPLAY",position:[38,111]},{type:"TOUCH_DOWN",id:"REPLAY",position:[38,106]},{type:"TOUCH_UP",id:"REPLAY",position:[-52,79]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-95,76]},{type:"TOUCH_UP",id:"REPLAY",position:[-312,100]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-319,100]},{type:"TOUCH_UP",id:"REPLAY",position:[-319,100]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-319,100]},{type:"TOUCH_DOWN",id:"REPLAY",position:[-319,100]}];!function(t){for(var i=function(t){var i=P(Math.floor(100*Math.random()));setTimeout((function n(){var o=1e3*Math.random(),e=i.next().value;e&&(c.push(Object(O.a)(Object(O.a)({},e),{},{id:t.toString()})),setTimeout(n,o))}),1e3)},n=0;n<t;n++)i(n)}(function(t,i){var n=function(t){var i=window.location.href;t=t.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(i);if(n)return n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):""}(t);if("boolean"===i)return""===n;if(void 0!==n)switch(i){case"integer":return parseInt(n,10);case"float":return parseFloat(n);case"string":return n}}("count","integer")||0);n(32);var E=n(7),C=n(8),y=n(0),f=n(2),L=function(){function t(){Object(y.a)(this,t)}return Object(f.a)(t,null,[{key:"angle",value:function(t){var i=Object(E.a)(t,2),n=i[0],o=i[1];return Math.atan2(o,n)}}]),t}();L.VECTOR_LENGTH=2,L.combine=function(t,i,n){for(var o=new Array(L.VECTOR_LENGTH),e=0;e<L.VECTOR_LENGTH;e++){var r=t[e],a=i[e];o[e]=n(r,a)}return L.fromArray(o)},L.add=function(t,i){return L.combine(t,i,(function(t,i){return t+i}))},L.subtract=function(t,i){return L.combine(t,i,(function(t,i){return t-i}))},L.multiply=function(t,i){return L.combine(t,i,(function(t,i){return t*i}))},L.scale=function(t,i){return L.fromArray(t.map((function(t){return t*i})))},L.divide=function(t,i){return L.combine(t,i,(function(t,i){return t/i}))},L.normalise=function(t){var i=L.euclideanLength(t);return 0===i?L.zero():L.scale(t,1/i)},L.sqrEuclideanLength=function(t){return Math.pow(t[0],2)+Math.pow(t[1],2)},L.euclideanLength=function(t){return Math.pow(L.sqrEuclideanLength(t),.5)},L.sqrEuclideanDistance=function(t,i){var n=L.subtract(t,i);return L.sqrEuclideanLength(n)},L.euclideanDistanceV2=function(t,i){var n=L.subtract(t,i);return L.euclideanLength(n)},L.rotate=function(t,i){var n=Object(E.a)(t,2),o=n[0],e=n[1],r=Math.cos(i),a=Math.sin(i);return[o*r-e*a,o*a+e*r]},L.zero=function(){return[0,0]},L.flipX=function(t){return[-t[0],t[1]]},L.flipY=function(t){return[t[0],-t[1]]},L.fromArray=function(t){if(t.length!==L.VECTOR_LENGTH)throw new Error("Cannot create V2 from ".concat(t,", length is ").concat(t.length,". Length should be ").concat(L.VECTOR_LENGTH));return t},L.fromVector2=function(t){return[t.x,t.y]};var H=function(){function t(){Object(y.a)(this,t)}return Object(f.a)(t,null,[{key:"reduceAction",value:function(t,i){switch(t.type){case"TOUCH_DOWN":switch(i.state){case"IDLE":case"TOUCHING":return{id:i.id,transform:i.transform,rotationDirection:i.rotationDirection,state:"TOUCHING",touchPosition:t.position}}break;case"TOUCH_UP":switch(i.state){case"IDLE":case"TOUCHING":return{id:i.id,transform:i.transform,rotationDirection:i.rotationDirection,state:"IDLE",idleTarget:t.position}}break;case"TOUCH_MOVE":switch(i.state){case"IDLE":case"TOUCHING":return{id:i.id,transform:i.transform,rotationDirection:i.rotationDirection,state:"TOUCHING",touchPosition:t.position}}}}},{key:"updateTransform",value:function(t,i){switch(t.state){case"IDLE":return this.updateIdle(t,i);case"TOUCHING":return this.updateTouching(t,i)}}},{key:"updateIdle",value:function(i,n){var o=t.rotateAround(i,i.idleTarget,n);return{position:o.position,rotation:o.rotation}}},{key:"rotateAround",value:function(t,i,n){var o=t.transform.position,e=t.rotationDirection,r=L.subtract(o,i),a=L.normalise(r),s=L.rotate(a,"CLOCKWISE"===e?-1:1),p=L.scale(s,this.MAX_CIRCLE_RADIUS),c=L.add(i,p),O=L.subtract(c,o),u=L.normalise(O),d=L.scale(u,this.SPEED*n);return{position:L.add(d,o),rotation:function(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI,e=function(t){return A(t-Math.floor(t/o)*o,0,o)}(i-t),r=e>Math.PI?e-2*Math.PI:e;return _(t,t+r,n)}(t.transform.rotation,L.angle(u),.1)}}},{key:"updateTouching",value:function(i,n){var o=t.rotateAround(i,i.touchPosition,n);return{position:o.position,rotation:o.rotation}}}]),t}();function _(t,i,n){return t+(i-t)*(n=(n=n<0?0:n)>1?1:n)}H.MAX_CIRCLE_RADIUS=100,H.MIN_CIRCLE_RADIUS=5,H.SPEED=100;var A=function(t,i,n){return Math.min(Math.max(i,t),n)};var R=function(){function t(){Object(y.a)(this,t)}return Object(f.a)(t,null,[{key:"update",value:function(i,n,o){var e=Object(C.a)(n);n.length=0,e.forEach((function(n){var o=i.find((function(t){return t.id===n.id}));if(void 0!==o){var e=H.reduceAction(n,o);Object.assign(o,e)}else t.addPlayerWithAction(n,i)})),i.forEach((function(t){var i=H.updateTransform(t,o);t.transform=i}))}},{key:"addPlayerWithAction",value:function(t,i){switch(t.type){case"TOUCH_DOWN":case"TOUCH_MOVE":i.push({id:t.id,state:"TOUCHING",rotationDirection:"ANTICLOCKWISE",touchPosition:t.position,transform:{rotation:0,position:t.position}});break;case"TOUCH_UP":i.push({id:t.id,state:"IDLE",rotationDirection:"ANTICLOCKWISE",idleTarget:t.position,transform:{rotation:0,position:t.position}})}}}]),t}(),l=[],Y=n(5),h=new Y.BoxBufferGeometry,D=new Y.MeshBasicMaterial({color:"pink"}),v=new Y.MeshBasicMaterial({color:"blue"}),N=new Y.MeshBasicMaterial({color:"green"}),m=window.innerWidth/100,b=function(t){var i=t.data,n=Object(e.useRef)();return Object(p.b)((function(){var t;if(n.current)if("IDLE"===i.state){n.current.visible=!0;var o=i.idleTarget;(t=n.current.position).set.apply(t,Object(C.a)(o).concat([0]))}else n.current.visible=!1})),Object(o.jsx)("mesh",{ref:n,name:"idleTarget",scale:[1*m,1*m,1],material:v,geometry:h})},W=window.innerWidth/100,j=function(t){var i=t.data,n=Object(e.useRef)();return Object(p.b)((function(t,o){var e;if(n.current){var r=i.transform.position,a=i.transform.rotation;(e=n.current.position).set.apply(e,Object(C.a)(r).concat([0])),n.current.rotation.set(0,0,a)}})),Object(o.jsx)("mesh",{ref:n,name:"player",scale:[5*W,5*W,1],position:[0,0,0],material:N,geometry:h,children:Object(o.jsx)("mesh",{position:[.5,0,0],scale:[.2,.2,.2],material:N,geometry:h})})},g=window.innerWidth/100,w=function(t){var i=t.data,n=Object(e.useRef)();return Object(p.b)((function(){var t;if(n.current)if("TOUCHING"===i.state){n.current.visible=!0;var o=i.touchPosition;(t=n.current.position).set.apply(t,Object(C.a)(o).concat([0]))}else n.current.visible=!1})),Object(o.jsx)("mesh",{ref:n,name:"touchTarget",scale:[1*g,1*g,1],material:D,geometry:h})},I=function(){var t=Object(e.useState)([]),i=Object(E.a)(t,2),n=i[0],a=i[1];Object(p.b)((function(t,i){R.update(l,c,i);var o=l.map((function(t){return t.id}));o.some((function(t){return!n.includes(t)}))&&a(o)}));var s=n.map((function(t,i){var n=l.find((function(i){return i.id===t}));return n?Object(o.jsxs)(r.a.Fragment,{children:[Object(o.jsx)(b,{data:n}),Object(o.jsx)(w,{data:n})]},t):null})),O=n.map((function(t,i){var n=l.find((function(i){return i.id===t}));return n?Object(o.jsx)(j,{data:n},t):null}));return Object(o.jsxs)(o.Fragment,{children:[s,O]})},M=function(t){return[t.clientX-window.innerWidth/2,-t.clientY+window.innerHeight/2]};var x=function(){var t=Object(e.useRef)(!1);return Object(o.jsx)("div",{className:"App",children:Object(o.jsx)(p.a,{orthographic:!0,pixelRatio:window.devicePixelRatio,concurrent:!0,style:{width:"100%",height:"100%"},onPointerDown:function(i){var n={type:"TOUCH_DOWN",id:"TEST",position:M(i)};c.push(n),t.current=!0},onPointerMove:function(i){if(t.current){var n={type:"TOUCH_MOVE",id:"TEST",position:M(i)};c.push(n)}},onPointerUp:function(i){var n={type:"TOUCH_UP",id:"TEST",position:M(i)};c.push(n),t.current=!1},children:Object(o.jsx)(I,{})})})};s.a.render(Object(o.jsx)(r.a.StrictMode,{children:Object(o.jsx)(x,{})}),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.21a6ffdb.chunk.js.map